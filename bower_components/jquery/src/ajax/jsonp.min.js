define(["../core","../var/isFunction","./var/nonce","./var/rquery","../ajax"],function(e,f,c,b){var a=[],d=/(=)\?(?=&|$)|\?\?/;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var g=a.pop()||(e.expando+"_"+(c++));this[g]=true;return g}});e.ajaxPrefilter("json jsonp",function(j,g,k){var m,h,i,l=j.jsonp!==false&&(d.test(j.url)?"url":typeof j.data==="string"&&(j.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&d.test(j.data)&&"data");if(l||j.dataTypes[0]==="jsonp"){m=j.jsonpCallback=f(j.jsonpCallback)?j.jsonpCallback():j.jsonpCallback;if(l){j[l]=j[l].replace(d,"$1"+m)}else{if(j.jsonp!==false){j.url+=(b.test(j.url)?"&":"?")+j.jsonp+"="+m}}j.converters["script json"]=function(){if(!i){e.error(m+" was not called")}return i[0]};j.dataTypes[0]="json";h=window[m];window[m]=function(){i=arguments};k.always(function(){if(h===undefined){e(window).removeProp(m)}else{window[m]=h}if(j[m]){j.jsonpCallback=g.jsonpCallback;a.push(m)}if(i&&f(h)){h(i[0])}i=h=undefined});return"script"}})});